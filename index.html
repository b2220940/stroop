<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã‚¹ãƒˆãƒ«ãƒ¼ãƒ—èª²é¡Œï¼ˆç ”ç©¶ç”¨ï¼‰</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 20px; }
    #quiz, #result, #practice, #main, #message { display: none; }
    button { padding: 10px 20px; margin: 10px; font-size: 18px; }
    .color-btn { width: 100px; height: 50px; font-size: 20px; color: white; border: none; border-radius: 8px; }
    #question { font-size: 48px; margin: 30px; }
  </style>
</head>
<body>
  <h1>ã‚¹ãƒˆãƒ«ãƒ¼ãƒ—èª²é¡Œï¼ˆç ”ç©¶ç”¨ï¼‰</h1>

  <!-- é–‹å§‹ç”»é¢ -->
  <div id="start">
    <p>åå‰ã¨æ°—æ¸©ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
    <input type="text" id="username" placeholder="åå‰"><br>
    <input type="number" id="temperature" placeholder="æ°—æ¸©ï¼ˆâ„ƒï¼‰"><br>
    <button onclick="startPractice()">ç·´ç¿’ã‚’é–‹å§‹</button>
  </div>

  <!-- ç·´ç¿’ãƒ¢ãƒ¼ãƒ‰ -->
  <div id="practice">
    <h2 id="practice-timer">ç·´ç¿’æ®‹ã‚Šæ™‚é–“: 30ç§’</h2>
    <p id="practice-question"></p>
    <div>
      <button class="color-btn" style="background:red" onclick="checkPractice('èµ¤')">èµ¤</button>
      <button class="color-btn" style="background:blue" onclick="checkPractice('é’')">é’</button>
      <button class="color-btn" style="background:green" onclick="checkPractice('ç·‘')">ç·‘</button>
      <button class="color-btn" style="background:gold" onclick="checkPractice('é»„')">é»„</button>
    </div>
  </div>

  <!-- ç·´ç¿’çµ‚äº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
  <div id="message">
    <h2>âœ… ç·´ç¿’ãŒçµ‚ã‚ã‚Šã¾ã—ãŸ</h2>
    <p>ãƒ«ãƒ¼ãƒ«ãŒç†è§£ã§ããŸã‚‰ã€Œæœ¬ç•ªã‚’é–‹å§‹ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</p>
    <button onclick="startMain()">æœ¬ç•ªã‚’é–‹å§‹</button>
  </div>

  <!-- æœ¬ç•ªãƒ¢ãƒ¼ãƒ‰ -->
  <div id="main">
    <h2 id="timer">æ®‹ã‚Šæ™‚é–“: 10:00</h2>
    <p id="question"></p>
    <div>
      <button class="color-btn" style="background:red" onclick="checkAnswer('èµ¤')">èµ¤</button>
      <button class="color-btn" style="background:blue" onclick="checkAnswer('é’')">é’</button>
      <button class="color-btn" style="background:green" onclick="checkAnswer('ç·‘')">ç·‘</button>
      <button class="color-btn" style="background:gold" onclick="checkAnswer('é»„')">é»„</button>
    </div>
    <p id="feedback" style="font-size: 24px; font-weight: bold; color: red;"></p>
  </div>

  <!-- çµæœç”»é¢ -->
  <div id="result">
    <h2>ãŠç–²ã‚Œã•ã¾ã§ã—ãŸï¼</h2>
    <p id="score"></p>
  </div>

<script>
let username = "", temp = "";
let correct = 0, total = 0;
let timeLeft = 600; // æœ¬ç•ª10åˆ†
let timerInterval;
let colors = ["èµ¤", "é’", "ç·‘", "é»„"];
let colorMap = { "èµ¤": "red", "é’": "blue", "ç·‘": "green", "é»„": "gold" };
let currentColor, currentText, currentMode; // â† new: mode è¿½åŠ ï¼ˆcolor or meaningï¼‰
let questionStartTime;

// --- ç·´ç¿’ãƒ¢ãƒ¼ãƒ‰ ---
let practiceTime = 30;
let practiceInterval;

function startPractice() {
  username = document.getElementById("username").value.trim();
  temp = document.getElementById("temperature").value.trim();
  if (!username || !temp) {
    alert("åå‰ã¨æ°—æ¸©ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
    return;
  }

  document.getElementById("start").style.display = "none";
  document.getElementById("practice").style.display = "block";
  nextPractice();

  practiceInterval = setInterval(() => {
    practiceTime--;
    document.getElementById("practice-timer").textContent = `ç·´ç¿’æ®‹ã‚Šæ™‚é–“: ${practiceTime}ç§’`;
    if (practiceTime <= 0) {
      clearInterval(practiceInterval);
      endPractice();
    }
  }, 1000);
}

function nextPractice() {
  currentText = colors[Math.floor(Math.random() * colors.length)];
  currentColor = colors[Math.floor(Math.random() * colors.length)];
  document.getElementById("practice-question").textContent = currentText;
  document.getElementById("practice-question").style.color = colorMap[currentColor];
}

function checkPractice(ans) {
  nextPractice(); // ç·´ç¿’ã§ã¯æ­£èª¤é–¢ä¿‚ãªãé€²è¡Œ
}

function endPractice() {
  document.getElementById("practice").style.display = "none";
  document.getElementById("message").style.display = "block";
}

// --- æœ¬ç•ªãƒ¢ãƒ¼ãƒ‰ ---
function startMain() {
  document.getElementById("message").style.display = "none";
  document.getElementById("main").style.display = "block";
  nextQuestion();
  startTimer();
}

function startTimer() {
  timerInterval = setInterval(() => {
    timeLeft--;
    let min = Math.floor(timeLeft / 60);
    let sec = timeLeft % 60;
    document.getElementById("timer").textContent =
      `æ®‹ã‚Šæ™‚é–“: ${min}:${sec.toString().padStart(2, "0")}`;

    if (timeLeft <= 0) {
      clearInterval(timerInterval);
      endQuiz();
    }
  }, 1000);
}

function nextQuestion() {
  currentText = colors[Math.floor(Math.random() * colors.length)];
  currentColor = colors[Math.floor(Math.random() * colors.length)];
  currentMode = Math.random() < 0.5 ? "color" : "meaning"; // 50%ãšã¤ã§ãƒ¢ãƒ¼ãƒ‰é¸æŠ
  total++;

  let questionText = document.getElementById("question");
  let feedback = document.getElementById("feedback");
  feedback.textContent = "";

  // è¡¨ç¤ºè¨­å®š
  questionText.textContent = currentText;
  questionText.style.color = colorMap[currentColor];

  if (currentMode === "color") {
    document.getElementById("timer").textContent += "ã€€ğŸ‘‰ ã‚¤ãƒ³ã‚¯ã®è‰²ã‚’ç­”ãˆã¦ãã ã•ã„";
  } else {
    document.getElementById("timer").textContent += "ã€€ğŸ‘‰ æ–‡å­—ã®æ„å‘³ã‚’ç­”ãˆã¦ãã ã•ã„";
  }

  // ã‚¿ã‚¤ãƒãƒ¼ã§10ç§’å¾Œã«è‡ªå‹•æ¬¡ã¸
  clearTimeout(questionStartTime);
  questionStartTime = setTimeout(() => {
    document.getElementById("feedback").textContent = "â° æ™‚é–“åˆ‡ã‚Œï¼";
    nextQuestion();
  }, 10000);
}

function checkAnswer(ans) {
  clearTimeout(questionStartTime);
  let feedback = document.getElementById("feedback");

  let isCorrect =
    (currentMode === "color" && ans === currentColor) ||
    (currentMode === "meaning" && ans === currentText);

  if (isCorrect) {
    correct++;
    nextQuestion();
  } else {
    feedback.textContent = "âŒ ä¸æ­£è§£ï¼ã‚‚ã†ä¸€åº¦ï¼";
  }
}

function endQuiz() {
  document.getElementById("main").style.display = "none";
  document.getElementById("result").style.display = "block";
  let accuracy = total > 0 ? ((correct / total) * 100).toFixed(1) : 0;

  document.getElementById("score").innerHTML =
    `æ­£ç­”æ•°: ${correct} / å•é¡Œæ•°: ${total}<br>æ­£ç­”ç‡: ${accuracy}%`;

  sendToGoogleForm(username, temp, correct, total, accuracy);
}

// Googleãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
function sendToGoogleForm(name, temp, correct, total, accuracy) {
  const formUrl =
    "https://docs.google.com/forms/d/e/1FAIpQLSdF_9dHEMEPIYEWloJs0Reo9emmZq0rrjFB3oIKExmbJE7ORQ/formResponse";
  const data = new FormData();
  data.append("entry.19896881", name);
  data.append("entry.665886500", temp);
  data.append("entry.142247126", correct);
  data.append("entry.2032695773", total);
  data.append("entry.566413443", accuracy);

  fetch(formUrl, { method: "POST", body: data, mode: "no-cors" })
    .then(() => console.log("Googleãƒ•ã‚©ãƒ¼ãƒ ã«é€ä¿¡ã—ã¾ã—ãŸ"));
}
</script>

</body>
</html>
