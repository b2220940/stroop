<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã‚¹ãƒˆãƒ«ãƒ¼ãƒ—èª²é¡Œï¼ˆç ”ç©¶ç”¨ï¼‰</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: "Noto Sans JP", sans-serif;
      text-align: center;
      background: #f8f9fa;
      color: #333;
      margin: 0;
      padding: 0;
    }

    h1 {
      background-color: #007bff;
      color: white;
      margin: 0;
      padding: 15px;
      font-size: 1.4em;
    }

    .container {
      padding: 20px;
      max-width: 500px;
      margin: auto;
    }

    input, button {
      font-size: 1.2em;
      padding: 10px;
      margin: 10px;
      width: 80%;
      max-width: 300px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }

    button {
      background-color: #007bff;
      color: white;
      border: none;
      cursor: pointer;
    }

    button:hover {
      background-color: #0056b3;
    }

    .color-btn {
      width: 45%;
      height: 60px;
      font-size: 1.3em;
      color: white;
      border: none;
      border-radius: 10px;
      margin: 8px;
    }

    #question {
      font-size: 2.5em;
      margin: 25px 0;
      min-height: 70px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #feedback {
      font-size: 1.3em;
      font-weight: bold;
      color: red;
      height: 1.5em;
    }

    #timer, #practice-timer {
      font-size: 1.1em;
      margin-top: 10px;
    }

    #practice-question { font-size: 48px; }


    @media (max-width: 480px) {
      #question { font-size: 2em; }
      .color-btn { width: 80%; height: 55px; }
    }

    #practice, #main, #message, #result {
      display: none;
    }
  </style>
</head>
<body>

  <h1>ã‚¹ãƒˆãƒ«ãƒ¼ãƒ—èª²é¡Œï¼ˆç ”ç©¶ç”¨ï¼‰</h1>

  <div class="container">

    <!-- é–‹å§‹ç”»é¢ -->
    <div id="start">
      <p>è¢«é¨“è€…åã¨æ¸©åº¦ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
      <input type="text" id="username" placeholder="åå‰ã‚’å…¥åŠ›"><br>
      <input type="number" id="temperature" placeholder="æ°´æ¸©ï¼ˆâ„ƒï¼‰ã‚’å…¥åŠ›"><br>
      <button onclick="startPractice()">ç·´ç¿’ã‚’é–‹å§‹</button>
    </div>

    <!-- ç·´ç¿’ãƒ¢ãƒ¼ãƒ‰ -->
    <div id="practice">
      <h3 id="practice-timer">ç·´ç¿’æ®‹ã‚Šæ™‚é–“: 30ç§’</h3>
      <div id="practice-question"></div>
      <p id="practice-instruction" style="font-weight:bold;"></p>
      <div>
        <button class="color-btn" style="background:red" onclick="checkPractice('èµ¤')">èµ¤</button>
        <button class="color-btn" style="background:blue" onclick="checkPractice('é’')">é’</button><br>
        <button class="color-btn" style="background:green" onclick="checkPractice('ç·‘')">ç·‘</button>
        <button class="color-btn" style="background:gold;color:white" onclick="checkPractice('é»„')">é»„</button>
      </div>
      <p id="practice-feedback"></p>
    </div>

    <!-- ç·´ç¿’çµ‚äº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
    <div id="message">
      <h2>âœ… ç·´ç¿’ãŒçµ‚äº†ã—ã¾ã—ãŸ</h2>
      <p>ãƒ«ãƒ¼ãƒ«ã‚’ç†è§£ã—ãŸã‚‰ã€Œæœ¬ç•ªã‚’é–‹å§‹ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</p>
      <button onclick="startMain()">æœ¬ç•ªã‚’é–‹å§‹</button>
    </div>

    <!-- æœ¬ç•ªãƒ¢ãƒ¼ãƒ‰ -->
    <div id="main">
      <h3 id="timer">æ®‹ã‚Šæ™‚é–“: 5:00</h3>
      <div id="question"></div>
      <p id="instruction" style="font-weight:bold;"></p>
      <div>
        <button class="color-btn" style="background:red" onclick="checkAnswer('èµ¤')">èµ¤</button>
        <button class="color-btn" style="background:blue" onclick="checkAnswer('é’')">é’</button><br>
        <button class="color-btn" style="background:green" onclick="checkAnswer('ç·‘')">ç·‘</button>
        <button class="color-btn" style="background:gold;color:white" onclick="checkAnswer('é»„')">é»„</button>
      </div>
      <p id="feedback"></p>
    </div>

    <!-- çµæœç”»é¢ -->
    <div id="result">
      <h2>ãŠç–²ã‚Œã•ã¾ã§ã—ãŸï¼</h2>
      <p id="score"></p>
    </div>

  </div>

<script>
let username = "", temp = "";
let correct = 0, total = 0;
let timeLeft = 300;
let timerInterval;
let colors = ["èµ¤", "é’", "ç·‘", "é»„"];
let colorMap = { "èµ¤": "red", "é’": "blue", "ç·‘": "green", "é»„": "gold" };
let currentColor, currentText, currentMode;
let questionTimer;

let practiceTime = 30;
let practiceInterval;

// ===== ç·´ç¿’ãƒ¢ãƒ¼ãƒ‰ =====
function startPractice() {
  username = document.getElementById("username").value.trim();
  temp = document.getElementById("temperature").value.trim();
  if (!username || !temp) {
    alert("åå‰ã¨æ¸©åº¦ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
    return;
  }

  document.getElementById("start").style.display = "none";
  document.getElementById("practice").style.display = "block";
  nextPractice();

  practiceInterval = setInterval(() => {
    practiceTime--;
    document.getElementById("practice-timer").textContent = `ç·´ç¿’æ®‹ã‚Šæ™‚é–“: ${practiceTime}ç§’`;
    if (practiceTime <= 0) {
      clearInterval(practiceInterval);
      endPractice();
    }
  }, 1000);
}

function nextPractice() {
  clearTimeout(questionTimer);
  currentText = colors[Math.floor(Math.random() * colors.length)];
  currentColor = colors[Math.floor(Math.random() * colors.length)];
  currentMode = Math.random() < 0.5 ? "color" : "meaning";

  const q = document.getElementById("practice-question");
  const feedback = document.getElementById("practice-feedback");
  const inst = document.getElementById("practice-instruction");
  feedback.textContent = "";

  q.textContent = currentText;
  q.style.color = colorMap[currentColor];
  inst.textContent = currentMode === "color" ? "ğŸ‘‰ ã‚¤ãƒ³ã‚¯ã®è‰²ã‚’ç­”ãˆã¦ãã ã•ã„" : "ğŸ‘‰ æ–‡å­—ã®æ„å‘³ã‚’ç­”ãˆã¦ãã ã•ã„";

  questionTimer = setTimeout(() => {
    feedback.textContent = "â° æ™‚é–“åˆ‡ã‚Œï¼";
    nextPractice();
  }, 10000);
}

function checkPractice(ans) {
  clearTimeout(questionTimer);
  const feedback = document.getElementById("practice-feedback");

  const isCorrect =
    (currentMode === "color" && ans === currentColor) ||
    (currentMode === "meaning" && ans === currentText);

  feedback.textContent = isCorrect ? "â­• æ­£è§£ï¼" : "âŒ ä¸æ­£è§£";
  setTimeout(nextPractice, 700);
}

function endPractice() {
  document.getElementById("practice").style.display = "none";
  document.getElementById("message").style.display = "block";
}

// ===== æœ¬ç•ªãƒ¢ãƒ¼ãƒ‰ =====
function startMain() {
  document.getElementById("message").style.display = "none";
  document.getElementById("main").style.display = "block";
  nextQuestion();
  startTimer();
}

function startTimer() {
  timerInterval = setInterval(() => {
    timeLeft--;
    let min = Math.floor(timeLeft / 60);
    let sec = timeLeft % 60;
    document.getElementById("timer").textContent = `æ®‹ã‚Šæ™‚é–“: ${min}:${sec.toString().padStart(2, "0")}`;
    if (timeLeft <= 0) {
      clearInterval(timerInterval);
      endQuiz();
    }
  }, 1000);
}

function nextQuestion() {
  clearTimeout(questionTimer);
  currentText = colors[Math.floor(Math.random() * colors.length)];
  currentColor = colors[Math.floor(Math.random() * colors.length)];
  currentMode = Math.random() < 0.5 ? "color" : "meaning";
  total++;

  const q = document.getElementById("question");
  const feedback = document.getElementById("feedback");
  const inst = document.getElementById("instruction");
  feedback.textContent = "";

  q.textContent = currentText;
  q.style.color = colorMap[currentColor];
  inst.textContent = currentMode === "color" ? "ğŸ‘‰ ã‚¤ãƒ³ã‚¯ã®è‰²ã‚’ç­”ãˆã¦ãã ã•ã„" : "ğŸ‘‰ æ–‡å­—ã®æ„å‘³ã‚’ç­”ãˆã¦ãã ã•ã„";

  questionTimer = setTimeout(() => {
    feedback.textContent = "â° æ™‚é–“åˆ‡ã‚Œï¼";
    nextQuestion();
  }, 10000);
}

function checkAnswer(ans) {
  clearTimeout(questionTimer);
  const feedback = document.getElementById("feedback");

  const isCorrect =
    (currentMode === "color" && ans === currentColor) ||
    (currentMode === "meaning" && ans === currentText);

  if (isCorrect) {
    correct++;
    feedback.textContent = "â­• æ­£è§£ï¼";
  } else {
    feedback.textContent = "âŒ ä¸æ­£è§£";
  }
  setTimeout(nextQuestion, 700);
}

function endQuiz() {
  document.getElementById("main").style.display = "none";
  document.getElementById("result").style.display = "block";
  let accuracy = total > 0 ? ((correct / total) * 100).toFixed(1) : 0;

  document.getElementById("score").innerHTML =
    `æ­£ç­”æ•°: ${correct} / å•é¡Œæ•°: ${total}<br>æ­£ç­”ç‡: ${accuracy}%`;

  sendToGoogleForm(username, temp, correct, total, accuracy);
}

// ===== Googleãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ =====
function sendToGoogleForm(name, temp, correct, total, accuracy) {
  const formUrl =
    "https://docs.google.com/forms/d/e/1FAIpQLSdF_9dHEMEPIYEWloJs0Reo9emmZq0rrjFB3oIKExmbJE7ORQ/formResponse";
  const data = new FormData();
  data.append("entry.19896881", name);
  data.append("entry.665886500", temp);
  data.append("entry.142247126", correct);
  data.append("entry.2032695773", total);
  data.append("entry.566413443", accuracy);
  fetch(formUrl, { method: "POST", body: data, mode: "no-cors" });
}
</script>
</body>
</html>
