<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ストループ課題（研究用）</title>
  <style>
    body { 
      font-family: sans-serif; 
      text-align: center; 
      padding: 20px; 
      max-width: 600px; 
      margin: auto;
    }
    #quiz, #result, #practice, #main, #message { display: none; }
    button { 
      padding: 14px 20px; 
      margin: 10px; 
      font-size: 20px; 
      border-radius: 10px;
      width: 45%;
      max-width: 200px;
    }

    .color-btn { 
      width: 140px;
      height: 60px; 
      font-size: 22px; 
      color: white; 
      border: none; 
      border-radius: 10px; 
      margin: 10px;
    }

    #question, #practice-question {
      font-size: 48px; 
      margin: 30px;
    }

    #feedback { 
      font-size: 26px; 
      font-weight: bold; 
      color: red; 
      min-height: 32px;
    }
  </style>
</head>
<body>
  <h1>ストループ課題（研究用）</h1>

  <!-- 開始画面 -->
  <div id="start">
    <p>名前と気温を入力してください</p>
    <input type="text" id="username" placeholder="名前"><br>
    <input type="number" id="temperature" placeholder="気温（℃）"><br>
    <button onclick="startPractice()">練習を開始</button>
  </div>

  <!-- 練習モード -->
  <div id="practice">
    <h2 id="practice-timer">練習残り時間: 30秒</h2>
    <p id="practice-question"></p>
    <div>
      <button class="color-btn" style="background:red" onclick="checkPractice()">赤</button>
      <button class="color-btn" style="background:blue" onclick="checkPractice()">青</button>
      <button class="color-btn" style="background:green" onclick="checkPractice()">緑</button>
      <button class="color-btn" style="background:gold; color:white;" onclick="checkPractice()">黄</button>
    </div>
  </div>

  <!-- 練習終了メッセージ -->
  <div id="message">
    <h2>✅ 練習が終わりました</h2>
    <p>ルールが理解できたら「本番を開始」を押してください。</p>
    <button onclick="startMain()">本番を開始</button>
  </div>

  <!-- 本番モード -->
  <div id="main">
    <h2 id="timer">残り時間: 10:00</h2>
    <p id="question"></p>
    <div>
      <button class="color-btn" style="background:red" onclick="checkAnswer('赤')">赤</button>
      <button class="color-btn" style="background:blue" onclick="checkAnswer('青')">青</button>
      <button class="color-btn" style="background:green" onclick="checkAnswer('緑')">緑</button>
      <button class="color-btn" style="background:gold; color:white;" onclick="checkAnswer('黄')">黄</button>
    </div>
    <p id="feedback"></p>
  </div>

  <!-- 結果画面 -->
  <div id="result">
    <h2>お疲れさまでした！</h2>
    <p id="score"></p>
  </div>


<script>
let username = "", temp = "";
let correct = 0, total = 0;
let timeLeft = 600; 
let timerInterval;
let colors = ["赤", "青", "緑", "黄"];
let colorMap = { "赤": "red", "青": "blue", "緑": "green", "黄": "gold" };
let currentColor, currentText, currentMode;
let questionStartTime;

// --- 練習モード ---
let practiceTime = 30;
let practiceInterval;

function startPractice() {
  username = document.getElementById("username").value.trim();
  temp = document.getElementById("temperature").value.trim();
  if (!username || !temp) {
    alert("名前と気温を入力してください");
    return;
  }

  document.getElementById("start").style.display = "none";
  document.getElementById("practice").style.display = "block";
  nextPractice();

  practiceInterval = setInterval(() => {
    practiceTime--;
    document.getElementById("practice-timer").textContent = `練習残り時間: ${practiceTime}秒`;
    if (practiceTime <= 0) {
      clearInterval(practiceInterval);
      endPractice();
    }
  }, 1000);
}

function nextPractice() {
  currentText = colors[Math.floor(Math.random() * colors.length)];
  currentColor = colors[Math.floor(Math.random() * colors.length)];

  let q = document.getElementById("practice-question");
  q.textContent = currentText;
  q.style.color = colorMap[currentColor];
}

function checkPractice() {
  nextPractice();
}

function endPractice() {
  document.getElementById("practice").style.display = "none";
  document.getElementById("message").style.display = "block";
}

// --- 本番 ---
function startMain() {
  document.getElementById("message").style.display = "none";
  document.getElementById("main").style.display = "block";
  nextQuestion();
  startTimer();
}

function startTimer() {
  timerInterval = setInterval(() => {
    timeLeft--;
    let min = Math.floor(timeLeft / 60);
    let sec = timeLeft % 60;
    document.getElementById("timer").textContent = `残り時間: ${min}:${sec.toString().padStart(2, "0")}`;

    if (timeLeft <= 0) {
      clearInterval(timerInterval);
      endQuiz();
    }
  }, 1000);
}

function nextQuestion() {
  currentText = colors[Math.floor(Math.random() * colors.length)];
  currentColor = colors[Math.floor(Math.random() * colors.length)];
  currentMode = Math.random() < 0.5 ? "color" : "meaning";
  total++;

  let q = document.getElementById("question");
  document.getElementById("feedback").textContent = "";

  q.textContent = currentText;
  q.style.color = colorMap[currentColor];

  clearTimeout(questionStartTime);
  questionStartTime = setTimeout(() => {
    document.getElementById("feedback").textContent = "⏰ 時間切れ！";
    nextQuestion();
  }, 10000);
}

function checkAnswer(ans) {
  clearTimeout(questionStartTime);
  let feedback = document.getElementById("feedback");

  let isCorrect =
    (currentMode === "color" && ans === currentColor) ||
    (currentMode === "meaning" && ans === currentText);

  if (isCorrect) {
    correct++;
    nextQuestion();
  } else {
    feedback.textContent = "❌ 不正解！";
    nextQuestion();
  }
}

function endQuiz() {
  document.getElementById("main").style.display = "none";
  document.getElementById("result").style.display = "block";

  let accuracy = total > 0 ? ((correct / total) * 100).toFixed(1) : 0;

  document.getElementById("score").innerHTML = 
    `正答数: ${correct} / ${total}<br>正答率: ${accuracy}%`;
}
</script>

</body>
</html>
